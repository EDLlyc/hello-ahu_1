<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å®‰å¾½å¤§å­¦æ ¡å‹è£èª‰å¢™</title>
  <style>
    /* 1. åŸºç¡€æ ·å¼è®¾ç½® */
    body {
      font-family: "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", Arial, sans-serif;
      background-color: #f0f2f5;
      margin: 0;
      padding: 20px;
      color: #333;
    }
    .container { max-width: 1200px; margin: auto; }
    h2 { text-align: center; color: #004ea2; margin-bottom: 30px; font-size: 28px; }

    /* 2. è¡¨å•åŒºåŸŸï¼šæœç´¢ä¸æ·»åŠ å¹¶æ’ */
    .forms-section {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      margin-bottom: 30px;
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: space-between;
      align-items: flex-start;
    }
    .form-group { flex: 1; min-width: 300px; }
    .form-group h3 { margin-top: 0; font-size: 16px; color: #666; border-left: 4px solid #004ea2; padding-left: 10px; }

    input[type="text"], input[type="email"], input[type="file"] {
      padding: 8px 12px;
      margin: 5px 0;
      border: 1px solid #d9d9d9;
      border-radius: 4px;
      width: calc(100% - 30px);
    }
    button {
      padding: 9px 20px;
      background: #004ea2;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.3s;
    }
    button:hover { background: #003370; }
    .clear-btn { color: #888; text-decoration: none; font-size: 14px; margin-left: 10px; }

    /* 3. æ ¡å‹å¡ç‰‡ç½‘æ ¼å¸ƒå±€ */
    .alumni-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 25px;
      justify-content: center;
      margin-bottom: 40px;
    }
    .alumni-card {
      background: white;
      width: 260px;
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.08);
      position: relative;
      padding: 25px 20px;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      text-align: center;
      border: 1px solid #eee;
    }
    .alumni-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 30px rgba(0,78,162,0.15);
    }

    /* 4. å¤´åƒæ ·å¼ */
    .avatar-wrapper {
      width: 100px;
      height: 100px;
      margin: 0 auto 15px;
      border-radius: 50%;
      overflow: hidden;
      border: 3px solid #004ea2;
      background: #fafafa;
    }
    .avatar-wrapper img { width: 100%; height: 100%; object-fit: cover; }
    .default-avatar {
      line-height: 100px;
      font-size: 32px;
      color: #ccc;
      font-weight: bold;
    }

    /* 5. ä¿¡æ¯å±•ç¤º */
    .alumni-card h3 { margin: 10px 0; color: #333; font-size: 20px; }
    .major-tag {
      background: #e6f7ff;
      color: #1890ff;
      padding: 2px 10px;
      border-radius: 10px;
      font-size: 13px;
      display: inline-block;
      margin-bottom: 15px;
    }
    .detail-info { font-size: 13px; color: #888; margin: 4px 0; }

    /* 6. åŠŸèƒ½å›¾æ ‡ */
    .edit-icon {
      position: absolute;
      top: 15px;
      right: 45px;
      color: #004ea2;
      text-decoration: none;
      font-size: 18px;
      line-height: 1;
    }
    .delete-icon {
      position: absolute;
      top: 15px;
      right: 15px;
      color: #ffccc7;
      text-decoration: none;
      font-size: 22px;
      line-height: 1;
    }
    .delete-icon:hover { color: #ff4d4f; }
    .card-footer {
      margin-top: 15px;
      padding-top: 12px;
      border-top: 1px solid #f0f0f0;
      font-size: 11px;
      color: #bfbfbf;
    }

    /* 7. åˆ†é¡µæ¡ä¸“ç”¨ç¾åŒ–æ ·å¼ */
    .pagination-container {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      text-align: center;
      margin-top: 30px;
    }
    .pagination-container p { color: #888; font-size: 14px; margin-bottom: 15px; }
    .pagination-nav {
      display: flex;
      justify-content: center;
      gap: 8px;
      align-items: center;
    }
    .page-link {
      padding: 8px 16px;
      text-decoration: none;
      border-radius: 6px;
      font-size: 14px;
      transition: all 0.3s;
      border: 1px solid #004ea2;
      color: #004ea2;
    }
    .page-link:hover { background: #e6f7ff; }
    .page-link.active {
      background: #004ea2;
      color: white;
    }
    .page-link.disabled {
      border-color: #d9d9d9;
      color: #bfbfbf;
      cursor: not-allowed;
      pointer-events: none;
    }
  </style>
</head>

<body>

<div class="container">

  <div style="text-align: right; margin-bottom: 15px;">
    <a th:if="${session.isAdmin == null}" th:href="@{/login}"
       style="color: #004ea2; text-decoration: none; font-size: 14px; border: 1px solid #004ea2; padding: 4px 12px; border-radius: 4px;">
      ğŸ” ç®¡ç†å‘˜ç™»å½•
    </a>
    <div th:if="${session.isAdmin != null}">
      <span style="font-size: 14px; color: #666;">å½“å‰èº«ä»½ï¼šğŸ“ ç³»ç»Ÿç®¡ç†å‘˜ | </span>
      <a th:href="@{/logout}" style="color: #ff4d4f; text-decoration: none; font-size: 14px; font-weight: bold;">é€€å‡ºç™»å½•</a>
    </div>
  </div>

  <h2>ğŸ“ å®‰å¾½å¤§å­¦æ ¡å‹è£èª‰å¢™</h2>

  <div style="text-align: center; margin-bottom: 20px;">
      <span style="background: #004ea2; color: white; padding: 5px 15px; border-radius: 20px; font-size: 14px;">
        ğŸŒŸ ç›®å‰å·²æœ‰ <strong id="totalNumber" th:text="${total}">0</strong> ä½å®‰å¤§ä¼˜ç§€æ ¡å‹å…¥é©»è£èª‰å¢™
      </span>
  </div>

  <div class="forms-section">
    <div class="form-group">
      <h3>åŠ å…¥è£èª‰å¢™</h3>
      <div th:unless="${session.isAdmin}"
           style="background: #fffbe6; border: 1px solid #ffe58f; padding: 15px; border-radius: 8px; text-align: center; margin-bottom: 10px;">
        <p style="color: #856404; font-size: 13px; margin: 0;">
          ğŸ”’ <strong>è®¿å®¢é¢„è§ˆæ¨¡å¼ï¼š</strong> è¯·å…ˆç™»å½•ç®¡ç†å‘˜è´¦å·ä»¥ç™»è®°ä¿¡æ¯ã€‚
        </p>
      </div>
      <form th:action="@{/add-alumni}" method="post" enctype="multipart/form-data">
        <input type="text" name="name" placeholder="æ ¡å‹å§“å" required>
        <input type="text" name="major" placeholder="æ‰€å­¦ä¸“ä¸š" required>
        <input type="email" name="email" placeholder="ç”µå­é‚®ç®±" required>
        <input type="text" name="phone" placeholder="è”ç³»ç”µè¯">
        <div style="margin: 10px 0;">
          <span style="font-size: 12px; color: #999;">ä¸Šä¼ å¤´åƒï¼š</span>
          <input type="file" name="imageFile" accept="image/*" style="width: auto;">
        </div>
        <button type="submit">æäº¤ä¿¡æ¯</button>
      </form>
    </div>

    <div class="form-group">
      <h3>æŸ¥æ‰¾æ ¡å‹</h3>
      <form th:action="@{/search}" method="get">
        <input type="text" name="keyword" placeholder="è¾“å…¥å§“åå…³é”®è¯..." th:value="${currentKeyword}">
        <button type="submit">ç«‹å³æœç´¢</button>
        <a th:href="@{/alumni-wall}" class="clear-btn" th:if="${currentKeyword != null && currentKeyword != ''}">æ¸…é™¤ç»“æœ</a>
      </form>
      <p style="font-size: 12px; color: #999; margin-top: 10px;" th:if="${currentKeyword != null && currentKeyword != ''}">
        å…±æ‰¾åˆ° <span th:text="${alumniList.size()}" style="color: #004ea2; font-weight: bold;">0</span> ä½æ ¡å‹
      </p>
    </div>
  </div>

  <p th:if="${error}" style="color: #ff4d4f; text-align: center; font-size: 13px;" th:text="${error}"></p>

  <div class="alumni-grid">
    <div class="alumni-card" th:each="person : ${alumniList}">
      <a class="delete-icon" th:if="${session.isAdmin}"
         th:href="@{'/delete/' + ${person.id}}" onclick="return confirm('ç¡®å®šç§»é™¤è¯¥æ ¡å‹å—ï¼Ÿ')">Ã—</a>
      <a class="edit-icon" th:if="${session.isAdmin}"
         th:href="@{'/edit/' + ${person.id}}">âœ</a>

      <div class="avatar-wrapper">
        <img th:if="${person.avatar}" th:src="@{'/pics/' + ${person.avatar}}">
        <div th:unless="${person.avatar}" class="default-avatar">æ ¡</div>
      </div>

      <h3 th:text="${person.name}">å§“å</h3>
      <span class="major-tag" th:text="${person.major}">ä¸“ä¸š</span>
      <p class="detail-info">ğŸ“§ <span th:text="${person.email}">é‚®ç®±</span></p>
      <p class="detail-info">ğŸ“ <span th:text="${person.phone != null ? person.phone : 'æœªå¡«å†™'}">ç”µè¯</span></p>

      <div class="card-footer">
        ID: AHU-<span th:text="${person.id}">000</span>
      </div>
    </div>
  </div>

  <div class="pagination-container" th:if="${pages > 0}">
    <p>æ€»è®¡ [[${total}]] ä½æ ¡å‹ | å½“å‰ç¬¬ [[${current}]] / [[${pages}]] é¡µ</p>
    <div class="pagination-nav">
      <a th:href="@{/alumni-wall(pageNo=${current - 1})}"
         class="page-link" th:classappend="${current == 1} ? 'disabled' : ''">ä¸Šä¸€é¡µ</a>

      <span th:each="i : ${#numbers.sequence(1, pages)}">
          <a th:href="@{/alumni-wall(pageNo=${i})}" th:text="${i}"
             class="page-link" th:classappend="${i == current} ? 'active' : ''"></a>
      </span>

      <a th:href="@{/alumni-wall(pageNo=${current + 1})}"
         class="page-link" th:classappend="${current == pages} ? 'disabled' : ''">ä¸‹ä¸€é¡µ</a>
    </div>
  </div>

</div>

<script th:inline="javascript">
  const target = /*[[${total}]]*/ 0;
  let currentVal = 0;
  const element = document.getElementById('totalNumber');

  if (element && target > 0) {
    element.innerText = "0";
    const timer = setInterval(() => {
      currentVal++;
      element.innerText = currentVal;
      if (currentVal >= target) clearInterval(timer);
    }, 50);
  }
</script>

</body>
</html>